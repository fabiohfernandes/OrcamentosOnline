<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TESTER Agent - Universal Testing Dashboard</title>
    <script src="/socket.io/socket.io.js"></script>
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <i class="fas fa-robot"></i>
                <h1>TESTER</h1>
                <span class="subtitle">Universal Testing Agent</span>
            </div>
            <div class="status-bar">
                <div class="connection-status" id="connectionStatus">
                    <i class="fas fa-circle"></i>
                    <span>Connected</span>
                </div>
                <div class="last-update" id="lastUpdate">
                    Last Update: Never
                </div>
            </div>
        </header>

        <!-- Main Dashboard -->
        <div class="dashboard">
            <!-- Left Panel - Configuration -->
            <div class="left-panel">
                <!-- Project Configuration -->
                <div class="panel project-panel">
                    <h3><i class="fas fa-project-diagram"></i> Project Configuration</h3>
                    <div class="form-group">
                        <label for="projectName">Project Name:</label>
                        <input type="text" id="projectName" placeholder="Enter project name..." value="OrÃ§amentosOnline">
                        <button class="btn btn-primary" onclick="setProject()">
                            <i class="fas fa-save"></i> Set Project
                        </button>
                    </div>
                </div>

                <!-- Port Monitoring -->
                <div class="panel ports-panel">
                    <h3><i class="fas fa-network-wired"></i> Service Monitoring</h3>
                    <div class="ports-grid" id="portsGrid">
                        <!-- Ports will be populated dynamically -->
                    </div>
                    <button class="btn btn-secondary" onclick="updatePorts()">
                        <i class="fas fa-sync"></i> Update Ports
                    </button>
                </div>

                <!-- Test Configuration -->
                <div class="panel test-config-panel">
                    <h3><i class="fas fa-cogs"></i> Test Configuration</h3>
                    <div class="form-group">
                        <label for="testIterations">Test Iterations per Feature:</label>
                        <input type="range" id="testIterations" min="1" max="100" value="10"
                               oninput="updateIterationsDisplay(this.value)">
                        <span class="range-value" id="iterationsValue">10 times</span>
                    </div>
                </div>

                <!-- Auto Options -->
                <div class="panel auto-options-panel">
                    <h3><i class="fas fa-magic"></i> Auto Options</h3>
                    <div class="checkbox-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="autoRetry"> Auto Retry Failed Tests
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="autoFix"> Auto Fix Common Issues
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="autoRefreshScope"> Auto Refresh Scope
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="autoRestartContainers"> Auto Restart Containers
                        </label>
                    </div>
                    <button class="btn btn-secondary" onclick="updateAutoOptions()">
                        <i class="fas fa-save"></i> Save Options
                    </button>
                </div>

                <!-- Claude Integration Panel -->
                <div class="panel claude-integration-panel">
                    <h3><i class="fas fa-robot"></i> Claude Integration</h3>
                    <div class="claude-status" id="claudeStatus">
                        <div class="status-indicator" id="claudeStatusIndicator">
                            <i class="fas fa-circle"></i>
                            <span>Disconnected</span>
                        </div>
                    </div>

                    <div class="checkbox-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="claudeAutoMode">
                            <strong>ðŸ¤– Enable Claude Auto-Mode</strong>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="claudeAutoFix">
                            ðŸ”§ Auto Fix Issues (No Permission Needed)
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="claudeAutoTest">
                            ðŸ”„ Auto Re-Test After Fixes
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="claudeAutoAnalyze">
                            ðŸ“Š Auto Analyze Results
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="claudeAutoCommit">
                            ðŸ’¾ Auto Commit Fixes (Careful!)
                        </label>
                    </div>

                    <div class="form-group">
                        <label for="claudeMaxIterations">Max Auto Iterations:</label>
                        <input type="range" id="claudeMaxIterations" min="5" max="100" value="50"
                               oninput="updateClaudeIterationsDisplay(this.value)">
                        <span class="range-value" id="claudeIterationsValue">50 iterations</span>
                    </div>

                    <div class="claude-controls">
                        <button class="btn btn-success" id="enableClaudeBtn" onclick="enableClaudeIntegration()">
                            <i class="fas fa-robot"></i> Enable Claude
                        </button>
                        <button class="btn btn-warning" id="disableClaudeBtn" onclick="disableClaudeIntegration()" disabled>
                            <i class="fas fa-stop"></i> Disable Claude
                        </button>
                        <button class="btn btn-info" onclick="forceClaude()">
                            <i class="fas fa-bolt"></i> Force Cycle
                        </button>
                    </div>

                    <div class="claude-stats" id="claudeStats">
                        <div class="stat-row">
                            <span>Current Phase:</span>
                            <span id="claudePhase">idle</span>
                        </div>
                        <div class="stat-row">
                            <span>Iteration:</span>
                            <span id="claudeIteration">0</span>
                        </div>
                        <div class="stat-row">
                            <span>Issues Found:</span>
                            <span id="claudeIssues">0</span>
                        </div>
                        <div class="stat-row">
                            <span>Fixes Applied:</span>
                            <span id="claudeFixes">0</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Center Panel - Controls and Progress -->
            <div class="center-panel">
                <!-- Progress Indicator -->
                <div class="progress-section">
                    <div class="progress-circle" id="progressCircle">
                        <div class="progress-inner">
                            <div class="progress-percentage" id="progressPercentage">0%</div>
                            <div class="progress-label">Success Rate</div>
                        </div>
                    </div>
                    <div class="progress-stats">
                        <div class="stat">
                            <span class="stat-label">Iteration:</span>
                            <span class="stat-value" id="currentIteration">0</span>
                        </div>
                        <div class="stat">
                            <span class="stat-label">Success Rate:</span>
                            <span class="stat-value" id="successRate">0%</span>
                        </div>
                        <div class="stat">
                            <span class="stat-label">Total Tests:</span>
                            <span class="stat-value" id="totalTests">0</span>
                        </div>
                    </div>
                </div>

                <!-- Control Buttons -->
                <div class="controls">
                    <button class="btn btn-success btn-large" id="startBtn" onclick="startTesting()">
                        <i class="fas fa-play"></i> Start Testing
                    </button>
                    <button class="btn btn-warning btn-large" id="pauseBtn" onclick="pauseTesting()" disabled>
                        <i class="fas fa-pause"></i> Pause
                    </button>
                    <button class="btn btn-danger btn-large" id="stopBtn" onclick="stopTesting()" disabled>
                        <i class="fas fa-stop"></i> Stop
                    </button>
                </div>

                <!-- Action Buttons -->
                <div class="actions">
                    <button class="btn btn-info" onclick="refreshDiscovery()">
                        <i class="fas fa-refresh"></i> Refresh Scope
                    </button>
                    <button class="btn btn-secondary" onclick="saveBacklog()">
                        <i class="fas fa-save"></i> Save Backlog
                    </button>
                    <button class="btn btn-secondary" onclick="downloadLogs()">
                        <i class="fas fa-download"></i> Download Logs
                    </button>
                </div>
            </div>

            <!-- Right Panel - Results and Features -->
            <div class="right-panel">
                <!-- Real-time Test Results -->
                <div class="panel results-panel">
                    <h3><i class="fas fa-chart-line"></i> Real-time Results</h3>
                    <div class="results-container" id="resultsContainer">
                        <div class="no-results">No tests running</div>
                    </div>
                </div>

                <!-- Discovered Features -->
                <div class="panel features-panel">
                    <h3><i class="fas fa-search"></i> Discovered Features</h3>
                    <div class="features-container" id="featuresContainer">
                        <div class="no-features">Click "Refresh Scope" to discover features</div>
                    </div>
                </div>

                <!-- Error Log -->
                <div class="panel errors-panel">
                    <h3><i class="fas fa-exclamation-triangle"></i> Error Log</h3>
                    <div class="errors-container" id="errorsContainer">
                        <div class="no-errors">No errors</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Test Summary -->
        <div class="summary-section">
            <h3><i class="fas fa-clipboard-list"></i> Comprehensive Test Summary</h3>
            <div class="summary-grid">
                <div class="summary-card">
                    <div class="summary-title">Services Monitored</div>
                    <div class="summary-value" id="servicesCount">0</div>
                </div>
                <div class="summary-card">
                    <div class="summary-title">Features Discovered</div>
                    <div class="summary-value" id="featuresCount">0</div>
                </div>
                <div class="summary-card">
                    <div class="summary-title">Total Test Runs</div>
                    <div class="summary-value" id="totalRuns">0</div>
                </div>
                <div class="summary-card">
                    <div class="summary-title">Avg Response Time</div>
                    <div class="summary-value" id="avgResponseTime">0ms</div>
                </div>
            </div>
            <div class="summary-description" id="summaryDescription">
                TESTER Agent is ready to comprehensively test your project. Configure the services to monitor,
                set the number of test iterations, and start testing to achieve 100% success rate.
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner">
            <i class="fas fa-robot fa-spin"></i>
            <div>TESTER Agent Working...</div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div class="toast-container" id="toastContainer"></div>

    <script src="dashboard.js"></script>
</body>
</html>